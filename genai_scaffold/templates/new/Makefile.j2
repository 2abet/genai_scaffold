.PHONY: help setup test test-coverage run format lint clean

help:
	@echo "{{ project_name }} - Makefile Commands"
	@echo "======================================"
	@echo "setup          - Install dependencies"
	@echo "test           - Run tests"
	@echo "test-coverage  - Run tests with coverage"
	@echo "run            - Run the application"
	@echo "format         - Format code with black"
	@echo "lint           - Run linter (ruff)"
	@echo "clean          - Clean build artifacts"
{% if enable_docker %}	@echo "docker-up      - Start Docker services"
	@echo "docker-down    - Stop Docker services"
{% endif %}

setup:
{% if use_poetry %}	poetry install
{% else %}	pip install -r requirements.txt
	pip install -r requirements-dev.txt
{% endif %}

test:
{% if use_poetry %}	poetry run pytest tests/ -v
{% else %}	pytest tests/ -v
{% endif %}

test-coverage:
{% if use_poetry %}	poetry run pytest tests/ --cov=src --cov-report=html --cov-report=term
{% else %}	pytest tests/ --cov=src --cov-report=html --cov-report=term
{% endif %}

run:
{% if ui_framework == "streamlit" %}{% if use_poetry %}	poetry run streamlit run app.py
{% else %}	streamlit run app.py
{% endif %}{% elif ui_framework == "gradio" %}{% if use_poetry %}	poetry run python app.py
{% else %}	python app.py
{% endif %}{% elif ui_framework == "fastapi" %}{% if use_poetry %}	poetry run uvicorn app:app --reload
{% else %}	uvicorn app:app --reload
{% endif %}{% else %}	@echo "No UI framework configured. Run your scripts manually."
{% endif %}

format:
{% if use_poetry %}	poetry run black src/ tests/
	poetry run isort src/ tests/
{% else %}	black src/ tests/
	isort src/ tests/
{% endif %}

lint:
{% if use_poetry %}	poetry run ruff check src/ tests/
{% else %}	ruff check src/ tests/
{% endif %}

clean:
	find . -type d -name __pycache__ -exec rm -rf {} +
	find . -type f -name "*.pyc" -delete
	find . -type f -name "*.pyo" -delete
	find . -type d -name "*.egg-info" -exec rm -rf {} +
	rm -rf build/ dist/ .pytest_cache/ .coverage htmlcov/

{% if enable_docker %}docker-up:
	docker-compose up -d

docker-down:
	docker-compose down
{% endif %}
